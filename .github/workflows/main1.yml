name: Ubuntu Server on GitHub Actions

on:
  workflow_dispatch:  # executa manualmente

jobs:
  start-server:
    runs-on: ubuntu-latest
    steps:
      - name: Instalar dependências básicas
        run: |
          sudo apt update
          sudo apt install -y openssh-server net-tools neofetch htop curl

      - name: Configurar SSH
        run: |
          mkdir -p ~/.ssh
          echo "${{ secrets.SSH_PUBLIC_KEY }}" >> ~/.ssh/authorized_keys
          sudo service ssh start
          echo "SSH rodando na porta 22"
          ip a | grep inet

      - name: Criar túnel SSH com serveo.net
        run: |
          sudo apt install -y autossh
          nohup autossh -M 0 -N -R 2222:localhost:22 serveo.net &
          sleep 5
          echo "✅ Servidor iniciado!"
          echo "Acesse assim:"
          echo "ssh -p 2222 $(whoami)@serveo.net"

      - name: Mostrar informações do sistema
        run: |
          echo "=== SISTEMA ==="
          neofetch
          echo "==============="
